\documentclass[a4paper,12pt]{article}
\usepackage[T1]{fontenc}
\usepackage{fullpage,graphicx,psfrag,amsmath,amsfonts}
\usepackage[small,bf]{caption}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{lipsum}
\usepackage{url}
\usepackage{bm}
\usepackage{float}
\usepackage{kpfonts}
\usepackage{mathpazo}
\usepackage{enumitem}
\setitemize{noitemsep,topsep=0pt,parsep=0pt,partopsep=0pt}

\begin{document}
\author{Filippo Grotto VR460638}

\title{Physical Human Robot Interaction}

\maketitle
\tableofcontents

\section{Four channel bilateral teleoperation architecture}

\subsection{HW1: Continuous and discretized implementation}
Implement the SISO Four-channel bilateral teleoperation architecture with
\[
    C_m = B_m + \frac{K_m}{s} \quad
    C_s = B_s + \frac{K_s}{s}
\]
\[
    Z_m^{-1} = \frac{1}{M_ms + D_m} \quad
    Z_s^{-1} = \frac{1}{M_ss + D_s}
\]

\bigskip
\noindent where $Mm = 0.5$, $M_s = 2$. Moreover $D_s = 10$ and $D_m = 5$ or both zero in the initial case. In Fig \ref{fig:hw1} a simple plot of the positions and velocities (slave and master) are reported for proper selected tuning parameters of the related master and slave controller. In order to properly tune the controllers the following closed-loop systems were considered:

\[
G_m = \frac{1}{M_ms^2+B_ms+K_m} \quad
G_s = \frac{1}{M_ss^2+B_ss+K_s}
\]

\bigskip
\noindent The proper parameters were selected considering the step reponse of the two second order systems. For the human intention controller the parameters were selected by comparing the reference position with the master/slave position and perform proper tuning (an analytical closed-loop system might also be considered for this analysis).

\begin{figure}[H]
    \begin{center}
        \hspace*{-2cm}
        \includegraphics[scale=0.39]{images/hw1.eps}
    \end{center}
    \caption{Reference slave and master position are depicted in the first plot. Slave and Master velocities are reported in the second plot}
    \label{fig:hw1}
\end{figure}

\begin{figure}[H]
    \begin{center}
        \hspace*{-2cm}
        \includegraphics[scale=0.39]{images/hw1_forces.eps}
    \end{center}
    \caption{Master and slave velocity and forces compared when the environment is not attached to the end effector of the robot. The environment force has to be zero when not in contact}
    \label{fig:hw1_forces}
\end{figure}

\noindent Finally the entire architecture was translated in the related discretized version according to our specification in terms of encoders and the related derivative were performed using the simulink block. In the following section a proper estimation tool will be analysed.

\subsection{HW2: Derive hybrid matrix}

Derive the hybrid matrix for the four channel bilateral teleoperation considering the inner force loop at the master and slave side. We will consider $Z_{cm} = C_{6}$ and $Z_{sm} = C_{5}$. 

\[
\begin{bmatrix}  f_m \\ -v_s \end{bmatrix} = \begin{bmatrix}
    \overline{H_{11}} & \overline{H_{12}} \\
    \overline{H_{21}} &  \overline{H_{22}} \\
\end{bmatrix} = \begin{bmatrix}  v_m \\ f_s \end{bmatrix}
\]

\begin{figure}[H]
    \begin{center}
        \includegraphics[scale=0.4]{images/teleop.png}
    \end{center}
    \caption{Extended Lawrence Architecture taken from \textit{Global Transparency Analysis of the Lawrence Teleoperator Architecture} Edvard Naerum and Blake Hannaford. In our case $C_7$ and $C_8$ are zero}
    \label{fig:hw3_vel}
\end{figure}

\noindent Let's start by defining:
\begin{equation}
    v_m = Z_{cm}^{-1}(f_m -C_2f_s-C_4v_s+C_6f_m)
\end{equation}
\begin{equation}
    v_s = Z_{cs}^{-1}(-f_s +C_5f_s+C_1v_m+C_3f_m)
\end{equation}

\noindent Finally let's compute the 4 components of the hybrid matrix considering one component to zero at each step.
\[
    \overline{H_{11}} : f_m \rightarrow v_m \qquad f_s = 0
    \]\[
    Z_{cm}v_m = f_m - C_4Z_{cs}^{-1}C_1v_m - C_4Z_{cs}^{-1}C_3f_m + C_6f_m
\]\[
    v_m(Z_{cm}+C_4Z_{cs}^{-1}C_1) = f_m(1-C_4Z_{cs}^{-1}C_3 + C_6)
    \]\[
    \overline{H_{11}} = \frac{Z_{cm}Z_{cs}+C_1C_4}{(1+C_6)Z_{cs} - C_3C_4}
\]


\bigskip

\[
    \overline{H_{12}} : f_m \rightarrow f_s \qquad v_m = 0
    \]\[
    0 = f_m -C_2f_s -C_4Z_{cs}^{-1}C_5f_s + C_4Z_{cs}^{-1}f_s - C_6f_m
\]\[
    f_m(1-C_6-C_4Z_{cs}^{-1}C_3) = f_s(C_2+C_4Z_{cs}^{-1}C_5-C_4Z_{cs}^{-1})
    \]\[
    \overline{H_{12}} = \frac{C_2Z_{cs}-C_4(1+C_5)}{(1+C_6)Z_{cs} - C_3C_4}
\]

\bigskip

\[
    \overline{H_{21}} : -v_s \rightarrow v_m \qquad f_s = 0
    \]\[
    v_sZ_{cs} = -(C_1v_m + C_3f_m)
\]\[
    v_s(Z_{cs} - \frac{C_3C_4}{1+C_6} = -v_m(C_1 + \frac{C_3Z_{cm}}{1+C_6})
    \]\[
    \overline{H_{21}} = -\frac{C_1(1+C_6) + C_3Z_{cm}}{(1+C_6)Z_{cs} - C_3C_4}
\]


\bigskip

\[
    \overline{H_{22}} : -v_s \rightarrow f_s \qquad v_m = 0
\]\[
    v_sZ_{cs} = -(C_5f_s - f_s +C_5f_s)
\]\[
    v_s(Z_{cs}-\frac{C_3C_4}{1+C_6}) = -f_s(C_5 - 1 + \frac{C_3C_2}{1+C_6})
\]\[
    \overline{H_{22}} = \frac{(1-C_5)(1+C_6)-C_2C_3}{(1+C_6)Z_{cs}-C_3C_4}
\]

\subsection{HW3: Kalman Filter and Predictor}
The aim is to estimate the velocities and accelerations from noisy position measurements. Some samples were provided for the task and the kalman filter and predictor were implemented as well as the steady state versions. In Fig \ref{fig:hw3_vel} and in Fig \ref{fig:hw3_acc} the estimations of velocities and accelerations are reported. The equations for the kalman filter and predictor are not reported. Let's derive the discretized model for the position, velocities and accelerations to use in the kalman filter:

\begin{equation}
    \dot{x}(t) =  \begin{bmatrix}  0&1&0 \\ 0&0&1\\0&0&0 \end{bmatrix} x(t) + \begin{bmatrix}  0\\0\\1 \end{bmatrix} w(t)
    \qquad
    y(t) = \begin{bmatrix}  1&0&0 \end{bmatrix}x(t) + v(t)
\end{equation}

\noindent Let's discretize the continuous-time model:
\[
    A_d = e^{AT_s} = e^{\begin{bmatrix}  0&1&0 \\ 0&0&1\\0&0&0 \end{bmatrix}T_s} = \begin{bmatrix} 1&T_s&\frac{T_s^2}{2}\\0&1&T_s\\0&0&1 \end{bmatrix}
\]
\[
    C_d = C = \begin{bmatrix} 1&0&0 \end{bmatrix}
\]
\[
    B_d = \left (\int_{0}^{T_s} e^{\begin{bmatrix} 1&\tau&\tau^2/2\\0&1&\tau\\0&0&1 \end{bmatrix}} \,d\tau \right) = \begin{bmatrix} T_s^3/6\\T_s^2/2\\T_s \end{bmatrix}
\]


\begin{figure}[H]
    \begin{center}
        \includegraphics[scale=1.0]{images/velocities.eps}
    \end{center}
    \caption{Velocities estimations using kalman filter, kalman predictor and euler against the real values. As expected the euler approximation is much more noisy}
    \label{fig:hw3_vel}
\end{figure}

\begin{figure}[H]
    \begin{center}
        \includegraphics[scale=1.0]{images/acc.eps}
    \end{center}
    \caption{Accelerations estimations using kalman filter, kalman predictor and euler against the real values. As expected the euler approximation is much more noisy}
    \label{fig:hw3_acc}
\end{figure}

\end{document}
